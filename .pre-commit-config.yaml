minimum_pre_commit_version: "1.15"
default_stages: [commit, push]
default_language_version:
  python: python3.8

repos:
  #: PRE-COMMIT HOOKS
  #: out-of-the-box hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v2.5.0
    hooks:
      - id: no-commit-to-branch
        args: [--branch, staging, --branch, master, --pattern, release/.*]
      - id: check-case-conflict
      - id: name-tests-test
        args: ["--django"]
      - id: check-json
      - id: pretty-format-json
        args: ["--indent=4", "--autofix"]
      - id: check-toml
      - id: check-yaml
      - id: detect-private-key
      - id: debug-statements
      - id: check-docstring-first
      - id: trailing-whitespace
      - id: end-of-file-fixer

  #: Several regex hooks
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.5.1
    hooks:
      - id: python-no-log-warn
      - id: python-no-eval

  #: Format setup.cfg
  - repo: https://github.com/asottile/setup-cfg-fmt
    rev: v1.7.0
    hooks:
      - id: setup-cfg-fmt
        language_version: python3.7

  #: Upgrade old python syntax to new
  - repo: https://github.com/asottile/pyupgrade
    rev: v2.1.0
    hooks:
      - id: pyupgrade
        args: [--py36-plus]

  #: Fill isort's known_third_party config
  - repo: https://github.com/asottile/seed-isort-config
    rev: v2.1.0
    hooks:
      - id: seed-isort-config
        args: [--application-directories, "src:."]

  #: Sort imports
  - repo: https://github.com/timothycrosley/isort
    rev: 4.3.21
    hooks:
      - id: isort
        args: [--apply, --recursive]

  #: Black for python code in docs
  - repo: https://github.com/asottile/blacken-docs
    rev: v1.6.0
    hooks:
      - id: blacken-docs
        additional_dependencies: [black==19.10b0]

  #: Black
  - repo: https://github.com/psf/black
    rev: 19.10b0
    hooks:
      - id: black
        args: [--safe]

# TODO: 16.04.2020: Currently bandit is unusable with pre-commit .. wait for fix .. remove in tox then
#  #: Python source code security analyzer
#  - repo: https://github.com/PyCQA/bandit
#    rev: 1.6.2
#    hooks:
#      - id: bandit
#        args: ["--exclude ./.tox/*,./.eggs/*,./tests/*"]

  #: flake8
  - repo: https://gitlab.com/pycqa/flake8
    rev: 3.7.9 # TODO: check flake8 3.8 .... tox config
    hooks:
      - id: flake8
        additional_dependencies:
          #: Check for python builtins being used as variables or parameters.
          #: A001-A002
          - "flake8-builtins==1.5.2"
          #: Finding likely bugs and design problems
          #: B001-B014 | B301-B306 | B901-B903,B950
          - "flake8-bugbear==20.1.4"
          #: Write better list/set/dict comprehensions
          #: C400-C416
          - "flake8-comprehensions==3.2.2"
          #: Check docstrings with PEP257
          #: D100-D107 | D200-D215 | D300-D302 | D400-D417
# TODO: 16.04.2020: Wait for https://github.com/PyCQA/pydocstyle/pull/446 to fix problem with noqa before module docstrings
          # - "flake8-docstrings==1.5.0"
          #: Find dead/out-commented code
          #: E800
          - "flake8-eradicate==0.3.0"
          #: Validate (lack of) logging format strings
          #: G001-G004, G010 | G100 | G200-G202
          - "flake8-logging-format==0.6.0"
          #: Find line breaks with '\'
          #: N400
          - "flake8-broken-line==0.2.0"
          #: Check your code against PEP 8 naming conventions
          #: N801-N807, N811-N817
          - "pep8-naming==0.10.0"
          #: Find mutable default assignments in func/class definitions
          #: M511
          - "flake8-mutable==1.2.0"
          #: Check common style issues or inconsistencies with pytest-based tests
          #: PT001-PT019
          - "flake8-pytest-style==1.1.0"
          #: Check if typing imports are properly guarded
          #: TYP001 - TYP006
          - "flake8-typing-imports==1.9.0"
          #: Find strings with leading 'u'
          #: UPS
          - "flake8-no-u-prefixed-strings==0.2"
          #: Make more readable variables names
          #: VNE001-VNE003
          - "flake8-variables-names==0.0.2"
          #: Checks for misuse of sys.version or sys.version_info (Py 3.10 / 4.0 comming)
          #: YTT101-YTT103 | YTT201-YTT204 | YTT301-YTT303
          - "flake8-2020==1.6.0"

# TODO: add bandit like pylint calling tox env
  #: pylint
  - repo: local
    hooks:
      - id: pylint
        args: [--rcfile=tox.ini, --ignore=version.py]
        name: pylint
#        entry: .tox/pre-commit/bin/pylint
#        entry: tox -e pylint-win,pylint-nix --
        entry: tox -e pylint --
        language: system
        types: [python]

#  #: mypy
#  - repo: https://github.com/pre-commit/mirrors-mypy
#    rev: v0.761
#    hooks:
#      - id: mypy
#        args: [--no-strict-optional, --ignore-missing-imports]
#        additional_dependencies: [tokenize-rt==3.2.0]
  - repo: local
    hooks:
      - id: mypy
        args: ["--config-file", "tox.ini"]
#        args: ["--config-file", "tox.ini", --no-strict-optional, --scripts-are-modules, --ignore-missing-imports]
        name: mypy
        entry: .tox/pre-commit/bin/mypy
        language: system
        types: [python]
        exclude: >
          (?x)^(
              setup.py|
              docs/source/conf.py
          )$

  #: Meta hooks
  - repo: meta
    hooks:
      - id: identity
        stages: [manual]
      - id: check-hooks-apply
        stages: [manual]
      - id: check-useless-excludes
        stages: [manual]
